- content_for :track_menu do
  .card.border-0.shadow-sm.mb-4
    .card-header.bg-secondary.text-white
      %h6.mb-0
        %i.bi.bi-tags.me-2
        = t('tracks')
    .card-body
      .d-flex.flex-wrap.gap-2
        - tracks_to_show = defined?(@tracks_with_events) ? @tracks_with_events : @conference.tracks_including_subs.includes(:events)
        - tracks_to_show.sort_by { |e| e.name }.each do |track|
          - if track.events.count > 0
            .col-auto
              %a.btn.btn-outline-primary.btn-sm{href: "##{track.name.downcase}", class: "track-#{track.name.parameterize}"}
                %i.bi.bi-tag.me-1
                = track.name
                %span.badge.bg-primary.ms-1= track.events.count

.row.mb-4
  .col-12
    %h2.title.mb-0
      %i.bi.bi-chat.me-2
      = t '.events'

- @view_model.events_by_track.each do |track_id, events|
  - if events.count > 0 && ! track_id.nil?
    - track = Track.find(track_id)

    %a{name: track.name.downcase}
    .card.mb-5.border-0.shadow-sm
      .card-header{class: "bg-primary text-white track-#{track.name.parameterize}"}
        %h4.mb-0
          %i.bi.bi-tag.me-2
          = track.name
          %span.badge.bg-light.text-dark.ms-2= "#{events.count} events"

      .card-body.p-0
        - events.each_with_index do |event, index|
          .row.g-3.p-3{class: (index < events.count - 1) ? 'border-bottom' : ''}
            .col-12.col-sm-3.col-md-2.text-center
              - if event.logo.present?
                = link_to image_box(event.logo, :small, class: "img-fluid rounded"), public_event_path(id: event.id)
              - else
                .bg-light.rounded.d-flex.align-items-center.justify-content-center{style: "height: 80px; width: 80px; margin: 0 auto;"}
                  %i.bi.bi-chat.text-muted{style: "font-size: 2rem;"}

            .col-12.col-sm-9.col-md-6
              %h6.mb-2
                = link_to event.title, public_event_path(id: event.id), class: "text-decoration-none fw-bold"
              - if event.abstract.present?
                .text-muted.small.mb-2
                  = truncate(event.abstract, length: 120, separator: ' ')
              .d-flex.flex-wrap.gap-2.align-items-center
                %span.badge{class: "bg-secondary track-#{track.name.parameterize}"}
                  = event.track.try(:name)
                - if event.start_time.present?
                  %span.badge.bg-info
                    %i.bi.bi-clock.me-1
                    = l event.start_time, format: :short
                - if event.room.present?
                  %span.badge.bg-warning.text-dark
                    %i.bi.bi-geo-alt.me-1
                    = event.room.name

            .col-12.col-md-4
              - if event.speakers.any?
                .small
                  %strong.text-muted.d-block.mb-2
                    %i.bi.bi-people.me-1
                    = t('col_speakers')
                  .d-flex.flex-wrap.gap-1
                    - event.speakers.each do |speaker|
                      = link_to speaker.public_name, public_speaker_path(id: speaker.id), class: "badge bg-success text-decoration-none"
